---
title: PyTorch에서 `pack_padded_sequence` 이해하기 - RNN 효율성 극대화하기
date: 2024-09-03 00:49:00 +0900
categories: [PyTorch, Functions]
tags: [PyTorch]     # TAG names should always be lowercase
author: moon
math: true
toc: true
---

딥러닝에서 자연어 처리(NLP)나 시계열 데이터 분석을 할 때, RNN(LSTM, GRU 등)을 사용하는 경우가 많습니다. 그러나 RNN은 입력되는 시퀀스의 길이가 일정하지 않을 때 비효율적으로 작동할 수 있습니다. 이를 해결하기 위해 PyTorch에서는 `nn.utils.rnn.pack_padded_sequence`라는 유용한 도구를 제공합니다. 이번 글에서는 이 함수의 역할과 사용 방법을 이해하기 쉽게 설명하겠습니다.

## 1. 시퀀스 데이터의 패딩 문제

RNN을 사용할 때, 입력 데이터의 길이가 다를 경우 일반적으로 길이가 가장 긴 시퀀스에 맞추어 나머지 시퀀스를 패딩합니다. 예를 들어, 세 개의 시퀀스를 생각해봅시다:

- 시퀀스 1: [1, 2, 3, 4, 5]
- 시퀀스 2: [6, 7, 8]
- 시퀀스 3: [9, 10]


이 시퀀스들을 동일한 길이로 맞추기 위해 다음과 같이 0으로 패딩을 추가할 수 있습니다:

- 시퀀스 1: [1, 2, 3, 4, 5]
- 시퀀스 2: [6, 7, 8, 0, 0]
- 시퀀스 3: [9, 10, 0, 0, 0]


여기서 문제가 생깁니다. RNN은 기본적으로 모든 요소를 동일하게 처리하므로, 0으로 패딩된 부분도 계산하게 됩니다. 이는 비효율적일 뿐만 아니라, 모델의 성능에 부정적인 영향을 미칠 수 있습니다.

<br>

## 2. pack_padded_sequence로 패딩 문제 해결하기

`pack_padded_sequence` 함수는 이러한 패딩된 시퀀스에서 불필요한 계산을 줄이는 데 큰 도움을 줍니다. 이 함수는 시퀀스의 *실제 유효한 길이를 기반으로 패딩된 부분을 제외한 데이터만을 패킹하여 RNN에 전달합니다.*

함수의 사용법은 다음과 같습니다:

```python
import torch.nn.utils.rnn as rnn_utils

x = rnn_utils.pack_padded_sequence(x, input_lengths, batch_first=True)
```

- **`x`**: 배치(batch) 형태의 시퀀스 데이터입니다.
- **`input_lengths`**: 각 시퀀스의 실제 길이를 나타내는 리스트나 텐서입니다.
- **`batch_first=True`**: 입력 데이터의 첫 번째 차원이 배치 크기임을 지정합니다.

<br>

## 3. 예시로 이해하기

위의 예시를 그대로 적용해 보겠습니다. 시퀀스의 실제 길이는 [5, 3, 2]이므로 `input_lengths`에 해당하는 값이 됩니다. 이제 이 데이터를 `pack_padded_sequence` 함수에 입력하면, 함수는 다음과 같이 동작합니다:

- 시퀀스 1: [1, 2, 3, 4, 5]
- 시퀀스 2: [6, 7, 8]
- 시퀀스 3: [9, 10]

여기서 0으로 패딩된 부분이 제거되고, 유효한 데이터만 남게 됩니다. 이렇게 패킹된 데이터는 RNN에 입력으로 주어지며, 모델은 패딩된 부분을 무시하고 실제 유효한 시퀀스 데이터만을 처리하게 됩니다.

<br>

## 4. pack_padded_sequence 의 장점

`pack_padded_sequence`를 사용하면 다음과 같은 장점이 있습니다:

- **효율성 증가**: 불필요한 패딩 계산을 제거함으로써 모델의 계산 효율성을 크게 향상시킵니다.
- **성능 향상**: RNN이 패딩된 데이터를 학습하지 않게 하여 모델의 정확도를 높일 수 있습니다.
- **메모리 절약**: 패딩을 제외한 실제 데이터만을 저장하고 계산하게 되므로 메모리 사용을 줄일 수 있습니다.

<br>

## 5. 결론

`pack_padded_sequence`는 RNN 계열 모델을 사용할 때 **시퀀스 데이터의 패딩 문제를 효과적으로 해결해주는 도구**입니다. 이 함수를 활용하면 모델의 효율성과 성능을 모두 높일 수 있습니다.